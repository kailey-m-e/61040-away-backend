---
timestamp: 'Sun Oct 12 2025 20:23:12 GMT-0400 (Eastern Daylight Time)'
content_id: 3e74d84ac17b24b66173daa4d0275a011aa3cc1188ec023ce8fea8cd77fc7f00
---

# file: src/concepts/UserAuthentication/UserAuthenticationConcept.ts

```typescript
import {Collection, Db} from "npm:mongodb";
import {Empty, ID} from "@utils/types.ts";
import {freshID} from "@utils/database.ts";

// Collection prefix to ensure namespace separation
const PREFIX = "UserAuthentication" + ".";

// Generic types for the concept's external dependencies
type User = ID;

/**
 * State: A set of Users with a username and password.
 */
export interface UsersDoc{
    _id: User;
    username: string;
    password: string;
}

/**
 * @concept Friending
 * @purpose To allow users to share special permissions with other users.
 */
export default class UserAuthenticationConcept {
    users: Collection<UsersDoc>;

    constructor(private readonly db: Db) {
        this.users = this.db.collection(PREFIX + "users");
    }

    /**
     * Action: Register a user with the given username and password.
     * @requires
     * @effects
     */
    async register({username, password}: {username: string, password: string}
    ): Promise<{user: User} | {error: string}> {
        const usernameExists = await this.users.findOne({username});
        if (usernameExists) {
            return {error: `Username already exists.`};
        }

        const newUserId = freshID() as User;
        await this.users.insertOne({_id: newUserId, username, password});
        return {user: newUserId};
    }

    /**
     * Action: Register a user with the given username and password.
     * @requires
     * @effects
     */
    async authenticate({username, password}: {username: string, password: string}
    ): Promise<Empty | {error: string}> {
        const usernameExists = await this.users.findOne({username});
        if (!usernameExists) {
            return {error: `Username doesn't exist.`};
        }

        const userMatch = await this.users.findOne({username, password});
        if (!userMatch) {
            return {error: `Password incorrect.`};
        }

        return {};
    }
}

```
