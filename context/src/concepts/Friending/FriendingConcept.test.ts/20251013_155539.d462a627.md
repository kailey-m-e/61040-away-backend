---
timestamp: 'Mon Oct 13 2025 15:55:39 GMT-0400 (Eastern Daylight Time)'
content_id: d462a627eb66dae07ad9de15eabd29f490c056269e7d7debc5c7337451d42b4b
---

# file: src\concepts\Friending\FriendingConcept.test.ts

```typescript
import {assert, assertEquals, assertExists, assertNotEquals} from "jsr:@std/assert";
import {testDb} from "@utils/database.ts";
import {Empty, ID} from "@utils/types.ts";
import FriendingConcept from "./FriendingConcept.ts";

const userA = "user:Alice" as ID;
const userB = "user:Bob" as ID;

/**
 * Test Case 1
 * Demonstrates operational principle: one user requests another, the other user accepts,
 * and the friendship is validated.
 */
Deno.test("Test Case 1 - operational principle", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User requests another
        const requestFriend = await friendingConcept.requestFriend({user: userA, friend: userB});
        assertNotEquals("error" in requestFriend, true, "Friend request should not fail.",);
        // const {post} = requestFriend as {post: ID};
        // assertExists(post);

        // 2. Other user accepts
        const acceptFriend = await friendingConcept.acceptFriend({user: userB, friend: userA});
        assertNotEquals("error" in acceptFriend, true, "Friend accept should not fail.",);

        // 3. Friendship is validated
        const validateFriendship = await friendingConcept.validateFriendship({user: userA, friend: userB});
        assertNotEquals("error" in validateFriendship, true, "Friendship validation should not fail.",);

    } finally {
        await client.close();
    }
});

/**
 * Test Case 2
 * Demonstrates user requests another user, who rejects the request;
 * friendship is not validated.
 */
Deno.test("Test Case 2", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. Creator makes post #1
        const createPost1 = await friendingConcept.create({
            creator: creatorA,
            title: "Newport Trip",
            city: "Newport",
            region: "Rhode Island",
            country: "United States",
            start: new Date(2025, 9, 14),
            end: new Date(2025, 9, 14),
            description: "Class of 2027 trip to Newport, RI!",
        });
        const {post: post1} = createPost1 as {post: ID};

        // 2. Creator makes post #2
        const createPost2 = await friendingConcept.create({
            creator: creatorA,
            title: "Virigina Wedding",
            city: "Charlottlesville",
            region: "Virginia",
            country: "United States",
            start: new Date(2025, 9, 5),
            end: new Date(2025, 9, 6),
            description: "Weekend wedding in Virginia!",
        });
        const {post: post2} = createPost2 as {post: ID};

        let posts = await friendingConcept._getPosts({user: creatorA});
        assertEquals(posts.length, 2, "The user should have 2 posts.");

        // 2. Creator edits post #2
        const editDates = await friendingConcept.editDates({user: creatorA, post: post2, start: new Date(2025, 9, 5), end: new Date(2025, 9, 7)});
        assertNotEquals("error" in editDates, true, "Editing dates should not fail.");
        const editDescription = await friendingConcept.editDescription({user: creatorA, post: post2, description: "Beautiful weekend wedding in Virginia!"});
        assertNotEquals("error" in editDescription, true, "Editing description should not fail.");

        // 3. Creator deletes post #2
        const deletePost2 = await friendingConcept.delete({user: creatorA, post: post2});
        assertEquals("error" in deletePost2, false, "Deleting post should not fail.");

        posts = await friendingConcept._getPosts({user: creatorA});
        assertEquals(posts.length, 1, "The user should have 1 post.");

        // 3. Creator makes post #3
        const createPost3 = await friendingConcept.create({
            creator: creatorA,
            title: "New York Visit",
            city: "Manhattan",
            region: "New York",
            country: "United States",
            start: new Date(2025, 7, 30),
            end: new Date(2025, 8, 1),
            description: "Tourist trip to New York!",
        });
        const {post: post3} = createPost3 as {post: ID};

        posts = await friendingConcept._getPosts({user: creatorA});
        assertEquals(posts.length, 2, "The user should have 2 post.");

        // 4. Creator edits post #3
        const editPlace = await friendingConcept.editPlace({user: creatorA, post: post3, city: "New York", region: "New York", country: "United States"});
        assertNotEquals("error" in editPlace, true, "Editing place should not fail.");

        // 5. Creator deletes post #1
        const deletePost1 = await friendingConcept.delete({user: creatorA, post: post1});
        assertEquals("error" in deletePost1, false, "Deleting post should not fail.");

        posts = await friendingConcept._getPosts({user: creatorA});
        assertEquals(posts.length, 1, "The user should have 1 post.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 3
 * Demonstrates user requests and then unrequests another user.
 */
Deno.test("Test Case 3", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {

        // 1. CreatorA makes post
        await friendingConcept.create({
            creator: creatorA,
            title: "Newport Trip",
            city: "Newport",
            region: "Rhode Island",
            country: "United States",
            start: new Date(2025, 9, 14),
            end: new Date(2025, 9, 14),
            description: "Class of 2027 trip to Newport, RI!",
        });

        // 2. CreatorB tries to edit that post
        const newTitle = "Rhode Island Trip";
        const editTitle = await friendingConcept.editTitle({user: creatorB, post: nonPost, title: newTitle});
        assertEquals("error" in editTitle, true, "Editing post with a different creator should fail.");

        // 3. CreatorB tries to delete that post
        const deletePost = await friendingConcept.delete({user: creatorB, post: nonPost});
        assertEquals("error" in deletePost!, true, "Deleting post with a different creator should fail.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 4
 * Demonstrates user tries to unrequest friend that was never requested;
 * user tries to accept and reject friend who didn't request user;
 * user tries to end friendship that was never created.
 */
Deno.test("Test Case 4", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User tries to edit post that doesn't exist
        const newTitle = "Rhode Island Trip";
        const editTitle = await friendingConcept.editTitle({user: creatorA, post: nonPost, title: newTitle});
        assertEquals("error" in editTitle, true, "Editing nonexistant post should fail.");

        // 2. User tries to delete post that doesn't exist
        const deletePost = await friendingConcept.delete({user: creatorA, post: nonPost});
        assertEquals("error" in deletePost!, true, "Deleting nonexistant post should fail.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 5
 * Mutliple friendships are created.
 */
Deno.test("Test Case 4", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User tries to edit post that doesn't exist
        const newTitle = "Rhode Island Trip";
        const editTitle = await friendingConcept.editTitle({user: creatorA, post: nonPost, title: newTitle});
        assertEquals("error" in editTitle, true, "Editing nonexistant post should fail.");

        // 2. User tries to delete post that doesn't exist
        const deletePost = await friendingConcept.delete({user: creatorA, post: nonPost});
        assertEquals("error" in deletePost!, true, "Deleting nonexistant post should fail.");

    } finally {
        await client.close();
    }
});

```
