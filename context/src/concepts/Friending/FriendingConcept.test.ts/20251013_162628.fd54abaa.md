---
timestamp: 'Mon Oct 13 2025 16:26:28 GMT-0400 (Eastern Daylight Time)'
content_id: fd54abaa822a397a7833423ff0dd51b79ba7f53a99132c01578e00f01a71400e
---

# file: src\concepts\Friending\FriendingConcept.test.ts

```typescript
import {assert, assertEquals, assertExists, assertNotEquals} from "jsr:@std/assert";
import {testDb} from "@utils/database.ts";
import {Empty, ID} from "@utils/types.ts";
import FriendingConcept from "./FriendingConcept.ts";

const userA = "user:Alice" as ID;
const userB = "user:Bob" as ID;

/**
 * Test Case 1
 * Demonstrates operational principle: one user requests another, the other user accepts,
 * and the friendship is validated.
 */
Deno.test("Test Case 1 - operational principle", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User requests another
        const requestFriend = await friendingConcept.requestFriend({user: userA, friend: userB});
        assertNotEquals("error" in requestFriend, true, "Friend request should not fail.");

        // 2. Other user accepts
        const acceptFriend = await friendingConcept.acceptFriend({user: userB, friend: userA});
        assertNotEquals("error" in acceptFriend, true, "Accepting friend should not fail.");

        // 3. Friendship is validated
        const validateFriendship = await friendingConcept.validateFriendship({user: userA, friend: userB});
        assertNotEquals("error" in validateFriendship, true, "Friendship validation should not fail.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 2
 * Demonstrates user requests another user, who rejects the request;
 * friendship is not validated.
 */
Deno.test("Test Case 2", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User requests another
        const requestFriend = await friendingConcept.requestFriend({user: userA, friend: userB});
        assertNotEquals("error" in requestFriend, true, "Friend request should not fail.");

        // 2. Other user rejects
        const rejectFriend = await friendingConcept.rejectFriend({user: userB, friend: userA});
        assertNotEquals("error" in rejectFriend, true, "Rejecting friend should not fail.");

        // 3. Friendship is not validated
        const validateFriendship = await friendingConcept.validateFriendship({user: userA, friend: userB});
        assertEquals("error" in validateFriendship, true, "Friendship validation should fail.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 3
 * Demonstrates user requests, unrequests, and then re-requests another user.
 */
Deno.test("Test Case 3", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User requests another
        const requestFriend = await friendingConcept.requestFriend({user: userA, friend: userB});
        assertNotEquals("error" in requestFriend, true, "Friend request should not fail.");

        // 2. User unrequests other
        const unrequestFriend = await friendingConcept.unrequestFriend({user: userA, friend: userB});
        assertNotEquals("error" in unrequestFriend, true, "Unrequesting friend should not fail.");

        // 3. User re-requests other
        const rreequestFriend = await friendingConcept.requestFriend({user: userA, friend: userB});
        assertNotEquals("error" in rreequestFriend, true, "Friend request should not fail.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 4
 * Demonstrates user tries to unrequest friend that was never requested;
 * user tries to accept and reject friend who didn't request user;
 * user tries to end friendship that was never created.
 */
Deno.test("Test Case 4", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User tries to edit post that doesn't exist
        const newTitle = "Rhode Island Trip";
        const editTitle = await friendingConcept.editTitle({user: creatorA, post: nonPost, title: newTitle});
        assertEquals("error" in editTitle, true, "Editing nonexistant post should fail.");

        // 2. User tries to delete post that doesn't exist
        const deletePost = await friendingConcept.delete({user: creatorA, post: nonPost});
        assertEquals("error" in deletePost!, true, "Deleting nonexistant post should fail.");

    } finally {
        await client.close();
    }
});

/**
 * Test Case 5
 * Mutliple friendships are created.
 */
Deno.test("Test Case 4", async () => {
    const [db, client] = await testDb();
    const friendingConcept = new FriendingConcept(db);

    try {
        // 1. User tries to edit post that doesn't exist
        const newTitle = "Rhode Island Trip";
        const editTitle = await friendingConcept.editTitle({user: creatorA, post: nonPost, title: newTitle});
        assertEquals("error" in editTitle, true, "Editing nonexistant post should fail.");

        // 2. User tries to delete post that doesn't exist
        const deletePost = await friendingConcept.delete({user: creatorA, post: nonPost});
        assertEquals("error" in deletePost!, true, "Deleting nonexistant post should fail.");

    } finally {
        await client.close();
    }
});

```
