---
timestamp: 'Thu Oct 16 2025 15:21:08 GMT-0400 (Eastern Daylight Time)'
content_id: b8b1b0327264f0cd42b922815a8f0674a18f7ba5aa52e5b4b16a5baf508fb8a9
---

# file: src\concepts\Wishlist\WishlistConcept.ts

```typescript
import { Collection, Db } from "npm:mongodb";
import { Empty, ID } from "@utils/types.ts";
import { freshID } from "@utils/database.ts";

// Collection prefix to ensure namespace separation
const PREFIX = "Wishlist" + ".";

// Generic types for the concept's external dependencies
type User = ID;

// Internal entity types, represented as IDs
type Place = ID;
type Wishlist = ID;

/**
 * State: A set of Places with a city, region, and country.
 */
export interface PlaceDoc {
  _id: Place;
  city: string;
  region: string;
  country: string;
}

/**
 * State: A set of Wishlists with a user, and a set of userPlaces.
 */
interface WishlistDoc {
  _id: Wishlist;
  creator: User;
  userPlaces: Place[];
}

/**
 * @concept Wishlist
 * @purpose To keep track of a user's future dream destinations.
 */
export default class WishlistConcept {
  places: Collection<PlaceDoc>;
  wishlists: Collection<WishlistDoc>;

  constructor(private readonly db: Db) {
    this.places = this.db.collection(PREFIX + "places");
    this.wishlists = this.db.collection(PREFIX + "wishlist");
  }

  /**
   * Action: Creates a new wishlist.
   * @requires
   * @effects
   */
  async createWishlist(
    { creator }: { creator: User },
  ): Promise<{ wishlist: Wishlist } | { error: string }> {
    // check if wishlist already exists
    const existingWishlist = await this.wishlists.findOne({ creator });
    if (existingWishlist) {
      return { error: "A wishlist for this user already exists." };
    }

    const newWishlistId = freshID() as Wishlist;
    const userPlaces: Place[] = [];
    await this.wishlists.insertOne({
      _id: newWishlistId,
      creator,
      userPlaces,
    });

    return { wishlist: newWishlistId };
  }

  /**
   * Action: Adds a new place to an existing wishlist.
   * @requires
   * @effects
   */
  async addPlace(
    { user, wishlist, city, region, country }: {
      user: User;
      wishlist: Wishlist;
      city: string;
      region: string;
      country: string;
    },
  ): Promise<{ place: Place } | { error: string }> {
    // checks
    const currWishlist = await this.wishlists.findOne({ _id: wishlist });
    if (!currWishlist) {
      return { error: `Wishlist with ID ${wishlist} not found.` };
    }

    const existingPlace = await this.wishlists.findOne({
      _id: wishlist,
      userPlaces: { city, region, country },
    });
    if (existingPlace) {
      return {
        error:
          `Place "${city}, ${region}, ${country}" already exists in wishlist.`,
      };
    }

    if (currWishlist!.creator !== user) {
      return { error: "Cannot edit another user's wishlist." };
    }

    const newPlaceId = freshID() as Place;

    await this.wishlists.updateOne({ _id: wishlist }, {
      $push: { userPlaces: newPlaceId, city, region, country },
    });

    return { place: newPlaceId };
  }

  /**
   * Action: Removes a place from an existing wishlist.
   * @requires
   * @effects
   */
  async removePlace(
    { user, wishlist, place }: {
      user: User;
      wishlist: Wishlist;
      place: Place;
    },
  ): Promise<Empty | { error: string }> {
    // checks
    const currWishlist = await this.wishlists.findOne({ _id: wishlist });
    if (!currWishlist) {
      return { error: `Wishlist with ID ${wishlist} not found.` };
    }

    if (currWishlist.creator !== user) {
      return { error: "Cannot edit another user's wishlist." };
    }

    const existingPlace = await this.wishlists.findOne({
      _id: wishlist,
      userPlaces: { _id: place },
    });

    if (!existingPlace) {
      return {
        error: `Place doesn't exist in wishlist.`,
      };
    }

    await this.wishlists.updateOne({ _id: wishlist }, {
      $deleteOne: { userPlaces: existingPlace._id },
    });
    return {};
  }

  /**
   * Query: Retrieves all places on a given user's wishlist.
   * @requires
   * @effects
   */
  async _getPlaces(
    { user }: { user: User },
  ): Promise<PlaceDoc[]> {
    const userWishlist = await this.wishlists.findOne({ creator: user });
    if (!userWishlist) {
      return [];
    }

    const placeIds = userWishlist.userPlaces;

    const places = await this.places.find({ _id: placeIds }).toArray();

    return places;
  }
}

```
